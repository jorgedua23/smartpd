<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartPDR | Intelligent Inventory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; margin: 0; }
        .spinner { width: 40px; height: 40px; border: 4px solid #f1f5f9; border-top: 4px solid #4f46e5; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "recharts": "https://esm.sh/recharts@2.5.0?deps=react@18.2.0",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1?deps=react@18.2.0"
      }
    }
    </script>

    <script type="module">
        import React from 'react';
        import ReactDOM from 'react-dom/client';
        import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell } from 'recharts';
        import { LayoutDashboard, Package, TrendingUp, Zap, FileText, Search, Upload, Info, AlertTriangle, CheckCircle, ArrowRight } from 'lucide-react';

        const { useState, useMemo } = React;

        // Tipos y Enums
        const PriorityLevel = {
            CRITICAL: 'Cr√≠tico',
            WARNING: 'Alerta',
            HEALTHY: '√ìptimo'
        };

        // Datos Mock
        const MOCK_DATA = [
            {
                id: 'SKU-7821',
                name: 'V√°lvula Presi√≥n Industrial X1',
                category: 'Hidr√°ulica',
                monthlySales: [145, 160, 130, 180, 195, 170],
                currentStock: 52,
                lastPurchaseDate: '2023-12-01',
                lastPurchaseQty: 200,
                criticality: 3
            },
            {
                id: 'SKU-1022',
                name: 'Cable Cobre 10mm (Rollo)',
                category: 'El√©ctrico',
                monthlySales: [40, 35, 50, 45, 30, 42],
                currentStock: 110,
                lastPurchaseDate: '2024-02-15',
                lastPurchaseQty: 60,
                criticality: 1
            },
            {
                id: 'SKU-9904',
                name: 'Lubricante T√©rmico HT',
                category: 'Qu√≠micos',
                monthlySales: [25, 30, 22, 28, 35, 32],
                currentStock: 12,
                lastPurchaseDate: '2023-11-20',
                lastPurchaseQty: 50,
                criticality: 2
            },
            {
                id: 'SKU-4501',
                name: 'Rodamiento Angular 6205',
                category: 'Mec√°nica',
                monthlySales: [80, 75, 90, 85, 95, 88],
                currentStock: 45,
                lastPurchaseDate: '2024-01-10',
                lastPurchaseQty: 150,
                criticality: 3
            },
            {
                id: 'SKU-3388',
                name: 'Filtro Aire Industrial',
                category: 'Neum√°tica',
                monthlySales: [15, 18, 20, 16, 22, 19],
                currentStock: 8,
                lastPurchaseDate: '2023-10-05',
                lastPurchaseQty: 40,
                criticality: 2
            }
        ];

        // Servicio de C√°lculo PDR
        const calculateInventoryMetrics = (items) => {
            const today = new Date();
            
            return items.map(item => {
                const demandaMensual = item.monthlySales.reduce((a, b) => a + b, 0) / Math.max(item.monthlySales.length, 1);
                const factorReserva = item.criticality === 3 ? 1.0 : item.criticality === 2 ? 0.5 : 0.2;
                const reservaSeguridad = Math.ceil(demandaMensual * factorReserva);
                const puntoPedido = Math.ceil(demandaMensual + reservaSeguridad);
                const stockObjetivo = Math.ceil(demandaMensual * 2.5);
                
                const lastPurchase = new Date(item.lastPurchaseDate);
                const agingDays = isNaN(lastPurchase.getTime()) ? 0 : Math.floor((today.getTime() - lastPurchase.getTime()) / (1000 * 60 * 60 * 24));
                
                let priority = PriorityLevel.HEALTHY;
                let score = 0;
                
                if (item.currentStock <= puntoPedido) {
                    priority = PriorityLevel.CRITICAL;
                    score = 100;
                } else if (item.currentStock <= stockObjetivo) {
                    priority = PriorityLevel.WARNING;
                    score = 50;
                } else {
                    priority = PriorityLevel.HEALTHY;
                    score = 10;
                }

                if (agingDays > 150) score += 20;

                return { 
                    ...item, 
                    demandaMensual, 
                    reservaSeguridad, 
                    puntoPedido, 
                    stockObjetivo, 
                    gap: stockObjetivo - item.currentStock,
                    agingDays, 
                    priority, 
                    priorityScore: score 
                };
            }).sort((a, b) => b.priorityScore - a.priorityScore);
        };

        // Servicio de IA (simulado)
        const getActionStrategy = async (items) => {
            return new Promise(resolve => {
                setTimeout(() => {
                    const critical = items.filter(i => i.priority === PriorityLevel.CRITICAL);
                    const highAging = items.filter(i => i.agingDays > 150);
                    
                    let report = `üìä AN√ÅLISIS ESTRAT√âGICO PDR\n\n`;
                    report += `üö® RIESGO CR√çTICO: ${critical.length} productos bajo punto de pedido.\n\n`;
                    
                    if (critical.length > 0) {
                        report += `ACCI√ìN INMEDIATA: "${critical[0].name}" requiere reabastecimiento urgente (Stock: ${critical[0].currentStock}, PDR: ${critical[0].puntoPedido}).\n\n`;
                    }
                    
                    if (highAging.length > 0) {
                        report += `üí∞ OPORTUNIDAD CASH: "${highAging[0].name}" tiene ${highAging[0].agingDays} d√≠as sin rotaci√≥n. Considere promoci√≥n o redistribuci√≥n.\n\n`;
                    }
                    
                    report += `‚úÖ RECOMENDACI√ìN: Priorizar √≥rdenes de compra para productos cr√≠ticos y evaluar liquidaci√≥n de inventario envejecido.`;
                    
                    resolve(report);
                }, 2000);
            });
        };

        // Componente StatCard
        const StatCard = ({ title, value, icon, colorClass }) => (
            React.createElement('div', {
                className: 'bg-white p-6 lg:p-8 rounded-3xl shadow-sm border border-slate-100 flex items-center space-x-6 hover:shadow-md transition-shadow'
            },
                React.createElement('div', {
                    className: `p-5 rounded-2xl ${colorClass} shadow-inner flex-shrink-0`
                }, icon),
                React.createElement('div', { className: 'min-w-0' },
                    React.createElement('p', {
                        className: 'text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1'
                    }, title),
                    React.createElement('p', {
                        className: 'text-3xl font-black text-slate-900 leading-none truncate'
                    }, typeof value === 'number' ? value.toLocaleString() : value)
                )
            )
        );

        // Componente NavItem
        const NavItem = ({ icon, label, active, onClick }) => (
            React.createElement('button', {
                onClick,
                className: `w-full flex items-center gap-4 px-4 py-3 rounded-xl font-bold transition-all ${
                    active ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-600/20' : 'text-slate-400 hover:bg-slate-800/50 hover:text-slate-100'
                }`
            },
                React.createElement('span', { className: 'flex-shrink-0' }, icon),
                React.createElement('span', { className: 'hidden lg:block text-sm' }, label)
            )
        );

        // Componente Principal
        const App = () => {
            const [items, setItems] = useState(calculateInventoryMetrics(MOCK_DATA));
            const [activeTab, setActiveTab] = useState('dashboard');
            const [aiReport, setAiReport] = useState('');
            const [searchTerm, setSearchTerm] = useState('');
            const [loadingAi, setLoadingAi] = useState(false);

            const generateAiReport = async () => {
                setLoadingAi(true);
                setAiReport('');
                try {
                    const report = await getActionStrategy(items);
                    setAiReport(report);
                } catch (error) {
                    setAiReport('Error al generar el reporte.');
                } finally {
                    setLoadingAi(false);
                }
            };

            const stats = useMemo(() => ({
                critical: items.filter(i => i.priority === PriorityLevel.CRITICAL).length,
                warning: items.filter(i => i.priority === PriorityLevel.WARNING).length,
                healthy: items.filter(i => i.priority === PriorityLevel.HEALTHY).length,
                totalStockValue: items.reduce((acc, i) => acc + i.currentStock, 0)
            }), [items]);

            const chartData = [
                { name: 'Cr√≠ticos', value: stats.critical, color: '#ef4444' },
                { name: 'Alertas', value: stats.warning, color: '#f59e0b' },
                { name: '√ìptimos', value: stats.healthy, color: '#10b981' }
            ];

            const filteredItems = useMemo(() => 
                items.filter(i => 
                    i.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    i.id.toLowerCase().includes(searchTerm.toLowerCase())
                ),
                [items, searchTerm]
            );

            return React.createElement('div', { className: 'flex h-screen bg-slate-50 overflow-hidden' },
                // Sidebar
                React.createElement('nav', { className: 'w-20 lg:w-64 bg-slate-900 flex flex-col items-center lg:items-start p-4 lg:p-6 transition-all duration-300' },
                    React.createElement('div', { className: 'flex items-center gap-3 mb-12' },
                        React.createElement('div', { className: 'bg-indigo-500 p-2 rounded-xl text-white shadow-lg shadow-indigo-500/30' },
                            React.createElement(Zap, { size: 24, fill: 'currentColor' })
                        ),
                        React.createElement('span', { className: 'hidden lg:block text-white font-black text-xl tracking-tight' },
                            'Smart', React.createElement('span', { className: 'text-indigo-400' }, 'PDR')
                        )
                    ),
                    React.createElement('div', { className: 'flex-1 w-full space-y-2' },
                        React.createElement(NavItem, { 
                            icon: React.createElement(LayoutDashboard, {}), 
                            label: 'Dashboard', 
                            active: activeTab === 'dashboard', 
                            onClick: () => setActiveTab('dashboard') 
                        }),
                        React.createElement(NavItem, { 
                            icon: React.createElement(Package, {}), 
                            label: 'Inventario', 
                            active: activeTab === 'inventory', 
                            onClick: () => setActiveTab('inventory') 
                        }),
                        React.createElement(NavItem, { 
                            icon: React.createElement(TrendingUp, {}), 
                            label: 'Consultor√≠a IA', 
                            active: activeTab === 'ai', 
                            onClick: () => { 
                                setActiveTab('ai'); 
                                if (!aiReport && !loadingAi) generateAiReport(); 
                            } 
                        })
                    )
                ),

                // Main Container
                React.createElement('main', { className: 'flex-1 overflow-y-auto relative bg-[#fcfdfe]' },
                    // Header
                    React.createElement('header', { className: 'sticky top-0 z-30 bg-white/80 backdrop-blur-md border-b border-slate-200 px-8 py-4 flex justify-between items-center' },
                        React.createElement('h1', { className: 'text-xl font-bold text-slate-900 capitalize' }, activeTab),
                        React.createElement('div', { className: 'flex items-center gap-4' },
                            React.createElement('div', { className: 'hidden md:flex items-center bg-slate-100 rounded-full px-4 py-2 text-slate-500' },
                                React.createElement(Search, { size: 16, className: 'mr-2' }),
                                React.createElement('input', {
                                    type: 'text',
                                    placeholder: 'Buscar SKU...',
                                    className: 'bg-transparent text-sm outline-none border-none w-48',
                                    value: searchTerm,
                                    onChange: (e) => setSearchTerm(e.target.value)
                                })
                            ),
                            React.createElement('div', { className: 'w-10 h-10 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-500' })
                        )
                    ),

                    // Content
                    React.createElement('div', { className: 'p-8 max-w-7xl mx-auto space-y-8' },
                        activeTab === 'dashboard' && React.createElement(React.Fragment, {},
                            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6' },
                                React.createElement(StatCard, { 
                                    title: 'Estado Cr√≠tico', 
                                    value: stats.critical, 
                                    icon: React.createElement(AlertTriangle, {}), 
                                    colorClass: 'bg-rose-50 text-rose-600' 
                                }),
                                React.createElement(StatCard, { 
                                    title: 'Nivel de Alerta', 
                                    value: stats.warning, 
                                    icon: React.createElement(Info, {}), 
                                    colorClass: 'bg-amber-50 text-amber-600' 
                                }),
                                React.createElement(StatCard, { 
                                    title: 'Stock √ìptimo', 
                                    value: stats.healthy, 
                                    icon: React.createElement(CheckCircle, {}), 
                                    colorClass: 'bg-emerald-50 text-emerald-600' 
                                }),
                                React.createElement(StatCard, { 
                                    title: 'Total Unidades', 
                                    value: stats.totalStockValue, 
                                    icon: React.createElement(Package, {}), 
                                    colorClass: 'bg-indigo-50 text-indigo-600' 
                                })
                            ),
                            React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-3 gap-8' },
                                React.createElement('div', { className: 'lg:col-span-2 bg-white rounded-3xl border border-slate-200 p-8 shadow-sm' },
                                    React.createElement('h3', { className: 'text-lg font-bold mb-6' }, 'Distribuci√≥n de Salud de Inventario'),
                                    React.createElement('div', { className: 'h-80' },
                                        React.createElement(ResponsiveContainer, { width: '100%', height: '100%' },
                                            React.createElement(BarChart, { data: chartData, margin: { top: 20, right: 30, left: 0, bottom: 0 } },
                                                React.createElement(CartesianGrid, { strokeDasharray: '3 3', vertical: false, stroke: '#f1f5f9' }),
                                                React.createElement(XAxis, { dataKey: 'name', axisLine: false, tickLine: false, tick: { fill: '#64748b', fontSize: 12 }, dy: 10 }),
                                                React.createElement(YAxis, { axisLine: false, tickLine: false, tick: { fill: '#64748b', fontSize: 12 } }),
                                                React.createElement(Tooltip, { cursor: { fill: '#f8fafc' }, contentStyle: { borderRadius: '16px', border: 'none', boxShadow: '0 10px 15px -3px rgb(0 0 0 / 0.1)' } }),
                                                React.createElement(Bar, { dataKey: 'value', radius: [8, 8, 0, 0], barSize: 60 },
                                                    chartData.map((entry, index) => 
                                                        React.createElement(Cell, { key: `cell-${index}`, fill: entry.color })
                                                    )
                                                )
                                            )
                                        )
                                    )
                                ),
                                React.createElement('div', { className: 'bg-gradient-to-br from-indigo-600 to-indigo-800 rounded-3xl p-8 text-white shadow-xl shadow-indigo-200 overflow-hidden relative' },
                                    React.createElement(Zap, { className: 'absolute -top-10 -right-10 w-48 h-48 opacity-10 rotate-12' }),
                                    React.createElement('h3', { className: 'text-xl font-bold mb-4' }, 'An√°lisis PDR'),
                                    React.createElement('p', { className: 'text-indigo-100 text-sm leading-relaxed mb-6' },
                                        `El sistema ha detectado que el ${items.length > 0 ? ((stats.critical / items.length) * 100).toFixed(0) : 0}% de sus referencias se encuentran por debajo del Punto de Pedido.`
                                    ),
                                    React.createElement('button', {
                                        onClick: () => setActiveTab('ai'),
                                        className: 'bg-white/10 hover:bg-white/20 backdrop-blur-sm px-6 py-3 rounded-xl flex items-center gap-2 font-bold transition-all'
                                    },
                                        'Ver recomendaciones ',
                                        React.createElement(ArrowRight, { size: 18 })
                                    )
                                )
                            )
                        ),

                        activeTab === 'inventory' && React.createElement('div', { className: 'bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden' },
                            React.createElement('div', { className: 'overflow-x-auto' },
                                React.createElement('table', { className: 'w-full text-left border-collapse' },
                                    React.createElement('thead', {},
                                        React.createElement('tr', { className: 'bg-slate-50/50' },
                                            React.createElement('th', { className: 'px-6 py-4 text-xs font-black uppercase tracking-wider text-slate-400' }, 'SKU / Producto'),
                                            React.createElement('th', { className: 'px-6 py-4 text-xs font-black uppercase tracking-wider text-slate-400' }, 'Stock Actual'),
                                            React.createElement('th', { className: 'px-6 py-4 text-xs font-black uppercase tracking-wider text-slate-400' }, 'Punto Pedido'),
                                            React.createElement('th', { className: 'px-6 py-4 text-xs font-black uppercase tracking-wider text-slate-400' }, 'Estado PDR'),
                                            React.createElement('th', { className: 'px-6 py-4 text-xs font-black uppercase tracking-wider text-slate-400 text-right' }, 'Aging')
                                        )
                                    ),
                                    React.createElement('tbody', { className: 'divide-y divide-slate-100' },
                                        filteredItems.length === 0 ? 
                                            React.createElement('tr', {},
                                                React.createElement('td', { colSpan: 5, className: 'px-6 py-8 text-center text-slate-400' }, 'No se encontraron productos')
                                            ) :
                                            filteredItems.map(item =>
                                                React.createElement('tr', { key: item.id, className: 'hover:bg-slate-50/80 transition-colors group' },
                                                    React.createElement('td', { className: 'px-6 py-4' },
                                                        React.createElement('div', { className: 'font-bold text-slate-900' }, item.name),
                                                        React.createElement('div', { className: 'text-xs text-slate-500 font-medium' }, `${item.id} ¬∑ ${item.category}`)
                                                    ),
                                                    React.createElement('td', { className: 'px-6 py-4 font-black text-slate-800' }, item.currentStock),
                                                    React.createElement('td', { className: 'px-6 py-4 font-medium text-slate-600' }, item.puntoPedido),
                                                    React.createElement('td', { className: 'px-6 py-4' },
                                                        React.createElement('span', {
                                                            className: `inline-flex items-center px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-tight ${
                                                                item.priority === PriorityLevel.CRITICAL ? 'bg-rose-50 text-rose-600' : 
                                                                item.priority === PriorityLevel.WARNING ? 'bg-amber-50 text-amber-600' : 'bg-emerald-50 text-emerald-600'
                                                            }`
                                                        }, item.priority)
                                                    ),
                                                    React.createElement('td', { className: 'px-6 py-4 text-right' },
                                                        React.createElement('span', {
                                                            className: `text-sm font-bold ${item.agingDays > 120 ? 'text-rose-500' : 'text-slate-500'}`
                                                        }, `${item.agingDays}d`)
                                                    )
                                                )
                                            )
                                    )
                                )
                            )
                        ),

                        activeTab === 'ai' && React.createElement('div', { className: 'max-w-4xl mx-auto py-12' },
                            React.createElement('div', { className: 'bg-white rounded-[2.5rem] border border-slate-200 p-12 shadow-sm text-center' },
                                React.createElement('div', { className: 'w-20 h-20 bg-indigo-50 rounded-3xl flex items-center justify-center mx-auto mb-8 text-indigo-600' },
                                    React.createElement(FileText, { size: 40 })
                                ),
                                React.createElement('h2', { className: 'text-3xl font-black mb-4 tracking-tight' }, 'Reporte Estrat√©gico IA'),
                                React.createElement('p', { className: 'text-slate-500 mb-10 max-w-md mx-auto' },
                                    'An√°lisis t√°ctico generado en tiempo real basado en su demanda actual y niveles de reserva de seguridad.'
                                ),
                                React.createElement('div', { className: 'bg-slate-50 rounded-3xl p-8 text-left border border-slate-100 min-h-[200px] flex items-center justify-center' },
                                    loadingAi ? 
                                        React.createElement('div', { className: 'flex flex-col items-center gap-4' },
                                            React.createElement('div', { className: 'spinner' }),
                                            React.createElement('span', { className: 'text-sm font-bold text-slate-400 animate-pulse' }, 'Generando an√°lisis...')
                                        ) :
                                        React.createElement('p', { className: 'text-slate-700 leading-relaxed font-medium whitespace-pre-line' },
                                            aiReport || 'Presione el bot√≥n para generar el informe t√°ctico.'
                                        )
                                ),
                                React.createElement('button', {
                                    onClick: generateAiReport,
                                    disabled: loadingAi,
                                    className: 'mt-10 bg-indigo-600 hover:bg-indigo-700 disabled:bg-slate-300 text-white font-black px-10 py-4 rounded-2xl transition-all flex items-center gap-3 mx-auto shadow-xl shadow-indigo-500/20'
                                },
                                    loadingAi ? 'Analizando...' : 'Refrescar An√°lisis IA',
                                    React.createElement(Zap, { size: 20, fill: 'currentColor' })
                                )
                            )
                        )
                    )
                )
            );
        };

        // Inicializar
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
